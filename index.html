<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>رحلة سنع — النسخة الذهبية</title>
<style>
:root{
  --gold-bg:#f6e6c9;
  --card:#fffdf8;
  --muted:#6b5a47;
  --gold:#c99b3a;
  --brown:#7b4f2b;
  --accent:#8c5a22;
  font-family: "Noto Naskh Arabic", "Segoe UI", Tahoma, sans-serif;
}
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(180deg,var(--gold-bg),#f2dfb3);color:#2a2a2a;display:flex;align-items:center;justify-content:center;padding:16px}
.app{width:100%;max-width:980px;border-radius:14px;overflow:hidden;background:linear-gradient(180deg,rgba(255,255,255,0.9),rgba(255,255,255,0.97));box-shadow:0 14px 40px rgba(20,20,20,0.08)}
.header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid rgba(0,0,0,0.04);background:linear-gradient(90deg, rgba(201,155,58,0.06), transparent)}
.logo{display:flex;gap:12px;align-items:center}
.logo .icon{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--gold),#ffd27a);display:flex;align-items:center;justify-content:center;font-weight:900;color:#6b3b00;font-size:22px}
.logo h1{margin:0;font-size:20px}
.tag{font-size:12px;color:var(--muted)}
.screen{display:none;padding:18px}
.screen.active{display:block}
.card{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 6px 18px rgba(0,0,0,0.04)}
.small{font-size:12px;color:var(--muted)}
.start-btn{background:linear-gradient(90deg,#b67e2b,#6b3b00);color:#fff;border:none;padding:10px 16px;border-radius:10px;font-weight:800;cursor:pointer}
.start-btn.gray{background:#6b6b6b}
.map-canvas{min-height:420px;border-radius:12px;padding:16px;position:relative;background:linear-gradient(180deg,#fff6e8,#fffaf0)}
.stage-dot{position:absolute;width:96px;height:96px;border-radius:12px;display:flex;align-items:center;justify-content:center;flex-direction:column;font-size:13px;cursor:pointer;background:rgba(255,255,255,0.95);box-shadow:0 6px 18px rgba(0,0,0,0.06);text-align:center;padding:6px}
.stage-dot.locked{filter:grayscale(1);opacity:0.6}
.stage-dot .emoji{font-size:28px}
.stage-dot .label{margin-top:6px;background:rgba(255,255,255,0.9);padding:4px 6px;border-radius:6px;font-size:13px}
#s1{left:6%;top:62%}
#s2{left:28%;top:40%}
#s3{left:48%;top:66%}
#s4{left:70%;top:36%}
#s5{left:84%;top:66%}
#s6{left:40%;top:18%}
#s7{left:72%;top:80%}
.stage-header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:8px}
.stage-title{font-weight:900;font-size:18px}
.story-area{display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap}
.story-text{flex:1}
.story-image{width:180px;border-radius:8px;object-fit:cover;border:2px solid rgba(0,0,0,0.04);background:#fff;padding:6px}
.question-area{margin-top:12px}
.question-title{font-weight:800;margin-bottom:8px}
.options{display:flex;flex-direction:column;gap:10px}
.option-btn{background:#fff;border:2px solid rgba(0,0,0,0.04);padding:12px;border-radius:10px;font-weight:800;cursor:pointer;text-align:right}
.option-btn.correct{border-color:rgba(45,150,45,0.25);background:linear-gradient(90deg,#f3fbf3,#fff)}
.option-btn.wrong{border-color:rgba(200,60,60,0.12);opacity:0.9}
.controls{display:flex;gap:8px;align-items:center;margin-top:10px}
.feedback{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;padding:18px}
.badge{width:86px;height:86px;border-radius:50%;background:linear-gradient(135deg,#ffd27a,#f6c34d);display:flex;align-items:center;justify-content:center;font-size:28px;box-shadow:0 8px 30px rgba(0,0,0,0.08)}
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center}
.modal .box{background:white;padding:16px;border-radius:12px;max-width:700px;width:94%}
@media (max-width:860px){ .story-image{display:none} .stage-dot{width:78px;height:78px} }
.top-info{display:flex;justify-content:space-between;align-items:center;gap:12px;width:100%}
.top-info .left, .top-info .right{font-size:13px;color:var(--muted)}
</style>
</head>
<body>
<div class="app" role="application" aria-label="رحلة سنع - النسخة الذهبية">
  <div class="header">
    <div class="logo"><div class="icon">س</div><div><h1>رحلة سنع</h1><div class="tag">ذكاء المستقبل... بسنع الأجداد</div></div></div>
    <div style="width:420px">
      <div class="top-info">
        <div class="right">فريق الثميد — مدرسة الثميد للبنات</div>
        <div class="left">هاكاثون الإمارات تبرمج</div>
      </div>
    </div>
  </div>

  <section id="splash" class="screen active">
    <div class="card" style="max-width:920px;margin:12px auto;text-align:right">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
        <div style="flex:1;text-align:right">
          <div style="font-weight:900;font-size:26px">رحلة سنع — النسخة الذهبية</div>
          <div class="small" style="margin-top:6px">انضمي إلى ميثا و"تراثي" في مغامرة سريعة تعيد لنا سنع الأجداد.</div>
        </div>
        <div style="width:220px;text-align:left">
          <img src="sheikhs.png" alt="الشيخ زايد والشيخ راشد" style="width:100%;height:110px;object-fit:cover;border-radius:8px" onerror="this.style.display='none'"/>
        </div>
      </div>

      <div style="margin-top:12px;padding:12px;border-radius:10px;background:linear-gradient(90deg, rgba(201,155,58,0.06), transparent);text-align:right">
        <div style="font-weight:800;margin-bottom:6px">بيانات الفريق للمسابقة</div>
        <div class="small"><strong>المسابقة:</strong> هاكاثون الإمارات تبرمج</div>
        <div class="small"><strong>المدرسة:</strong> مدرسة الثميد للبنات</div>
        <div class="small" style="margin-top:8px"><strong>أسماء الطالبات:</strong></div>
        <ul style="margin:6px 0 0 0;padding-left:18px;text-align:right">
          <li>ريم سالم</li>
          <li>الريم خالد</li>
          <li>شمايل عبدالله</li>
          <li>عزه احمد</li>
        </ul>
      </div>

      <div style="margin-top:14px;text-align:center">
        <p style="margin:6px 0">
          في يوم من الأيام، كانت ميثا — فتاة إماراتية تحب الذكاء الاصطناعي والتكنولوجيا — تزور يدّتها فاطمة في منطقة مليحة التراثية في إمارة الشارقة 🏜️.
          وأثناء وجودها هناك، تكتشف صندوقًا خشبيًا قديمًا داخل المجلس.
        </p>
        <p style="margin:6px 0; font-weight:700">
          عندما تفتحه، تجد جهازًا ذكيًا صغيرًا عليه كلمة: “تراثي” 🤖
        </p>
        <p style="margin:6px 0">
          تخبرها اليدّه أن هذا الجهاز فيه أسرار السنع الإماراتي، لكنه لا يشتغل إلا إذا حلّت ميثا مجموعة من الألغاز والمهمات التراثية.
          ومن هنا تبدأ رحلة سنع — رحلة بين الماضي والحاضر، بين الذكاء الاصطناعي والتراث، بين العلم والسنع الأصيل.
        </p>
        <div style="display:flex;gap:10px;justify-content:center;margin-top:10px">
          <button class="start-btn" id="startBtn">ابدأ الرحلة</button>
        </div>
        <div class="small" style="margin-top:8px">اللعبة: 7 مراحل • 5 أسئلة في كل مرحلة • قصص شعبية • زر خروج للخريطة في كل سؤال</div>
      </div>
    </div>
  </section>

  <section id="map" class="screen">
    <div class="card" style="padding:12px">
      <div class="map-canvas card">
        <svg width="100%" height="100%" style="position:absolute;left:0;top:0;z-index:0" viewBox="0 0 1100 700" preserveAspectRatio="none"><rect width="100%" height="100%" fill="#fff7ea"/></svg>
        <div id="s1" class="stage-dot" data-stage="1"><div class="emoji">🏠</div><div class="label">مجلس اليدّه</div></div>
        <div id="s2" class="stage-dot locked" data-stage="2"><div class="emoji">🏺</div><div class="label">السوق القديم</div></div>
        <div id="s3" class="stage-dot locked" data-stage="3"><div class="emoji">🌴</div><div class="label">المزرعة</div></div>
        <div id="s4" class="stage-dot locked" data-stage="4"><div class="emoji">🪨</div><div class="label">آثار الأجداد</div></div>
        <div id="s5" class="stage-dot locked" data-stage="5"><div class="emoji">🇦🇪</div><div class="label">قيام الاتحاد</div></div>
        <div id="s6" class="stage-dot locked" data-stage="6"><div class="emoji">🎭</div><div class="label">ثقافتنا</div></div>
        <div id="s7" class="stage-dot locked" data-stage="7"><div class="emoji">🏡</div><div class="label">بيت التراث</div></div>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;padding-top:10px">
        <div><div class="small">أوسمة مكتسبة</div><div id="progressText" class="small" style="font-weight:800">وسام السنع 0/7</div></div>
        <div><button id="openRewards" class="start-btn" style="padding:8px 12px;font-size:13px">ملف إنجاز ميثا</button></div>
      </div>
    </div>
  </section>

  <section id="stageScreen" class="screen">
    <div class="card">
      <div class="stage-header">
        <div>
          <div class="stage-title" id="stageTitle">المرحلة</div>
          <div class="small" id="stageSubtitle">وصف قصير</div>
        </div>
        <div>
          <button id="exitStage" class="start-btn gray">الخروج للخريطة</button>
        </div>
      </div>
      <div id="stageContent"></div>
    </div>
  </section>

  <section id="feedback" class="screen">
    <div class="card feedback">
      <div id="fbContent"></div>
      <div style="display:flex;gap:8px;margin-top:12px">
        <button id="fbNext" class="start-btn" style="display:none">التالي</button>
        <button id="fbMap" class="start-btn gray" style="display:none">العودة للخريطة</button>
      </div>
    </div>
  </section>

  <div id="rewardsModal" class="modal" style="display:none">
    <div class="box"><div class="card"><h3 style="margin-top:0">ملف إنجاز ميثا</h3><div id="medalsBox" style="display:flex;gap:8px;flex-wrap:wrap"></div><div style="margin-top:12px;text-align:left"><button id="closeRewards" class="start-btn">أغلق</button></div></div></div>
  </div>

  <div class="footer card" style="margin:12px">نموذج أولي • مقدم من فريق مدرسة الثميد للبنات</div>
</div>

<script>
/* ---------- State & DOM ---------- */
const screens = { splash: document.getElementById('splash'), map: document.getElementById('map'), stage: document.getElementById('stageScreen'), feedback: document.getElementById('feedback') };
const startBtn = document.getElementById('startBtn');
// const downloadBtn = document.getElementById('downloadBtn'); // تم حذف هذا الزر
const sDots = document.querySelectorAll('.stage-dot');
const exitStage = document.getElementById('exitStage');
const stageContent = document.getElementById('stageContent');
const stageTitle = document.getElementById('stageTitle');
const stageSubtitle = document.getElementById('stageSubtitle');
const fbContent = document.getElementById('fbContent');
const fbNext = document.getElementById('fbNext');
const fbMap = document.getElementById('fbMap');
const progressText = document.getElementById('progressText');
const rewardsModal = document.getElementById('rewardsModal');
const openRewards = document.getElementById('openRewards');
const closeRewards = document.getElementById('closeRewards');
const medalsBox = document.getElementById('medalsBox');

let state = { currentStage: null, medals: 0, stagesCompleted: {1:false,2:false,3:false,4:false,5:false,6:false,7:false}, stageProgress: {} };

/* ---------- Stage Content (المحتوى المحدث) ---------- */
// تم تحديث هذا المحتوى ليحتوي على 5 أسئلة لكل مرحلة، ولإزالة الألعاب التفاعلية المدمجة مسبقاً
const STAGES = {
  // المرحلة 1: آداب المجلس (5 أسئلة)
  1: {
    id: 1,
    title: 'المرحلة 1: آداب المجلس',
    subtitle: 'السنع: إكرام الضيف',
    story: `<div class="story-area"><div class="story-text"><strong>قصة: الضيف الكريم</strong><p>في يومٍ من الأيام، دخل ضيف كبير إلى مجلس يدّتها فاطمة. رحّب به الجميع بحرارة وقدّموا له القهوة باليد اليمنى، كما علمتهم العادات الإماراتية القديمة. جلست ميثا تراقب كل حركة، ولاحظت كيف أن ابتسامة الترحيب ونبرة الصوت الهادئة تجعل الضيف يشعر بالراحة والاحترام. تعلمت أن احترام الكبير والترحيب بالضيف هو أساس السنع، وأن الكرم لا يكتمل إلا بالنية الطيبة.</p><p style="font-weight:700;margin-top:10px">المثل: "الضيف ضيف الله، والكرم من شيم العرب."</p></div></div>`,
    questions: [
      { q: 'لو دخلتي المجلس والقهوة توها مصبوبة، شو تسوين؟', opts: ['أمد يدي وآخذ الفنجان على طول','أنتظر المضيف يقدمه وأقول: شكراً','أطلب كوب ماي قبل القهوة'], a: 1, hint: 'السنع يفرض الانتظار حتى يُقدّم المضيف، وهذا جزء من الاحترام.' },
      { q: 'إذا دخل ضيف كبير في السن، شو تسوين؟', opts: ['أجلس مكاني وأسلم وأنا جالسة','أوقف وأسلم عليه وأرحب فيه','أتجاهله وأكمل اللي كنت أسويه'], a: 1, hint: 'السنع يحث على الوقوف للترحيب بكبار السن، وهو دليل على التقدير.' },
      { q: 'لو خلصتي الفنجان، شو تسوين؟', opts: ['أرجع الفنجان من غير ما أحرّكه','أحرك الفنجان شوي عشان يعرفون أني اكتفيت','ألوّح بإصبعي'], a: 1, hint: 'تحريك الفنجان هو الإشارة التقليدية لانتهاء الرغبة في المزيد، وهذا من أصول الضيافة.' },
      { q: 'كيف تُعبّرين عن احترامك للكلام عندما يتحدث شخص أكبر منك سناً في المجلس؟', opts: ['أقطعه لأصحح كلامه','أنصت له باهتمام ولا أقاطعه','أشتغل بهاتفي'], a: 1, hint: 'من السنع، الإنصات وعدم المقاطعة دليل على حكمة المتحدث.' },
      { q: 'ما هو التصرف المناسب إذا رأيت فنجان القهوة فارغاً عند ضيفك؟', opts: ['أسأله إذا كان يريد الماء','أتركه حتى يطلب بنفسه','أقوم بتقديم فنجان آخر فوراً'], a: 2, hint: 'السنع والكرم يفرضان تقديم الفنجان الجديد فوراً دون انتظار الطلب (إذا لم يُشر الضيف بالاكتفاء).' }
    ]
  },
  // المرحلة 2: السوق القديم (5 أسئلة)
  2: {
    id: 2,
    title: 'المرحلة 2: السوق القديم',
    subtitle: 'السنع: الأمانة والصدق',
    story: `<div class="story-area"><div class="story-text"><strong>قصة: التاجر الصادق</strong><p>ذهبت ميثا إلى السوق القديم، حيث رائحة البهارات والتمور تملأ المكان. رأت البائعين يتبادلون التحية والابتسامات مع الزبائن، وشاهدت بائعًا يعيد لزبون نسي الزيادة بالغلط. لاحظت أن الأمانة والصدق كانوا زينة التاجر، وأن التعامل بالعدل يجعل الناس تحبه وتثق فيه. فهمت أن السنع لا يقتصر على المجالس، بل يشمل كل تعاملاتنا اليومية.</p><p style="font-weight:700;margin-top:10px">المثل: "الصدق زين، والكذب شين."</p></div></div>`,
    questions: [
      { q: 'إذا شفت ميزان قديم في السوق، شو كان يستخدمونه؟', opts: ['لقياس الطول','وزن البضائع','للزينة فقط'], a: 1, hint: 'الميزان (القبان) هو أداة أساسية للتأكد من عدل التعامل بين البائع والمشتري في الوزن.' },
      { q: 'إذا جاك زبون وما عندك الشي اللي يبيه، شو تسوين؟', opts: ['تقول له "ما عندي" وتمشي','تدله على بائع ثاني يساعده','تتجاهله'], a: 1, hint: 'السنع التجاري يشمل الكياسة والتعاون مع الزملاء والتجار لخدمة الزبون.' },
      { q: 'هل من الأدب تكاسر البائع؟', opts: ['نعم، بس بأدب واحترام وابتسامة','لا، الكاسر عيب دائمًا','أصرخ لين يخفض السعر'], a: 0, hint: 'المساومة جزء من ثقافة السوق، ولكن يجب أن تكون مصحوبة بالأدب والاحترام.' },
      { q: 'إذا اشتريت سلعة ووجدت بائعاً آخر يبيعها بسعر أقل بكثير بعد مغادرة السوق، ما هو السنع؟', opts: ['أعود وألوم البائع الأول بصوت مرتفع','أتقبل الأمر وأدرك أن المنافسة أمر طبيعي','أحاول إفساد بضاعة البائع الأول'], a: 1, hint: 'النزاهة في التعامل تقتضي عدم إلقاء اللوم على البائع الأول بعد إتمام الصفقة، وتقبّل المنافسة.' },
      { q: 'في التراث، ما هي القيمة التي تسبق الربح في التعامل التجاري؟', opts: ['سرعة البيع','الأمانة وجودة السلعة','كمية البضاعة'], a: 1, hint: 'السمعة الطيبة والأمانة هما أساس التجارة القديمة.' }
    ]
  },
  // المرحلة 3: المزرعة (5 أسئلة)
  3: {
    id: 3,
    title: 'المرحلة 3: المزرعة',
    subtitle: 'السنع: الصبر والعطاء',
    story: `<div class="story-area"><div class="story-text"><strong>قصة: النخلة والأجداد</strong><p>زارت ميثا المزرعة مع جدها، وشاهدت النخيل الطويل الممتد في صفوف منظمة. ساعدت جدها في سقي الفسائل الصغيرة، وتعلمت أن كل شجرة تحتاج إلى صبر وعناية. قال لها جدها: "النخلة مثل الإنسان، إذا اهتمّيت فيها وأعطيتها حبك ووقتك، تعطيك خيرها." فهمت ميثا أن الزراعة ليست فقط عملًا جسديًا، بل درس في الصبر والعطاء والسنع الإماراتي الأصيل.</p><p style="font-weight:700;margin-top:10px">المثل: "الزرع من بذره، والكرم من أصله."</p></div></div>`,
    questions: [
      { q: 'أول خطوة في العناية بالنخلة؟', opts: ['اختيار الفسيلة','ريّها بماء مالح','قطع جذورها'], a: 0, hint: 'تبدأ عملية الاهتمام بالنخلة باختيار بداية جيدة لضمان جودة الثمار.' },
      { q: 'شو ترمز له النخلة في حياة الإماراتيين؟', opts: ['رمز للكرم والعطاء','رمز للكسل','مجرد شجرة عادية'], a: 0, hint: 'النخلة شجرة مباركة تعطي دون أن تطلب، وهي أساس الحياة قديماً.' },
      { q: 'عند حصاد التمر، شو تسوين؟', opts: ['تاكلينه وتخليه يخرب','تخزينه وتوزيعه على الناس','تتركه في الشمس'], a: 1, hint: 'سنع الحصاد يتضمن المشاركة والتوزيع على الأهل والجيران.' },
      { q: 'ما الذي يميز "البرحي" عن أنواع التمور الأخرى؟', opts: ['يؤكل طازجاً (خلال مرحلة الخلال والرطب)','يستخدم فقط في الطهي','لا يُزرع في الإمارات'], a: 0, hint: 'يُعرف البرحي بأنه من التمور التي يُفضل أكلها في مرحلة الرطب (قبل النضج الكامل).' },
      { q: 'ما أهمية "المهباش" في الحياة القديمة؟', opts: ['أداة لجمع التمر','يستخدم لطحن القهوة وإصدار صوت يجمع الناس','لقياس عمق البئر'], a: 1, hint: 'صوت المهباش كان إشارة للجيران بالمرور والجلوس لشرب القهوة (دليل على الكرم).' }
    ]
  },
  // المرحلة 4: آثار الأجداد (5 أسئلة)
  4: {
    id: 4,
    title: 'المرحلة 4: آثار الأجداد',
    subtitle: 'السنع: احترام الماضي والتعلم منه',
    story: `<div class="story-area"><div class="story-text"><strong>قصة: متحف مليحة</strong><p>زارت ميثا متحف مليحة، حيث عرضت الرسومات والنقوش القديمة التي تحكي حياة الأجداد. رأت النقوش التي تصور جمال الصحراء والصيادين والجمال، ولاحظت كيف استخدم الأجداد هذه الرسومات لتوثيق حياتهم وحكاياتهم. شعرت ميثا بالدهشة والإعجاب، وفهمت أن السنع الحقيقي يكمن في احترام الماضي وتعلم الحكم من تجارب الأجداد.</p><p style="font-weight:700;margin-top:10px">المثل: "من حفظ قديمه، أمن من جديده."</p></div></div>`,
    questions: [
      { q: 'ليش الأجداد كانوا يرسمون رموز على الصخور؟', opts: ['عشان يتفاخرون','لتوثيق قصصهم وحياتهم','للزينة فقط'], a: 1, hint: 'النقوش هي شكل من أشكال الحفظ والتواصل عبر الأجيال.' },
      { q: 'لو شفت نقش قديم، شو تسوين؟', opts: ['المسه وغيريه','أحترمه وأتعلم منه','أرسم فوقه'], a: 1, hint: 'احترام الآثار وعدم العبث بها هو من احترام الماضي.' },
      { q: 'شو كانت تدل الرموز القديمة غالبًا؟', opts: ['حكايات عن الحيوانات والصيد والرحلات','عن المدن الحديثة','عن الألعاب الإلكترونية'], a: 0, hint: 'كانت النقوش تعكس طبيعة الحياة اليومية القديمة.' },
      { q: 'لما يكتشف الباحثون نقشًا، شو يسوون فيه؟', opts: ['يدرسونه ويحافظون عليه','يمسحونه','يبيعونه'], a: 0, hint: 'يجب دراسة التراث والحفاظ عليه لأنه ذاكرة الوطن.' },
      { q: 'شو نتعلم من هالرموز؟', opts: ['أن أجدادنا حكماء وخلّاقين','أنهم كانوا يلعبون فقط','أنهم ما عرفوا شيء عن الكتابة'], a: 0, hint: 'الرموز تدل على إبداع الأجداد وقدرتهم على التعبير والتوثيق.' }
    ]
  },
  // المرحلة 5: قيام الاتحاد (5 أسئلة)
  5: {
    id: 5,
    title: 'المرحلة 5: قيام الاتحاد',
    subtitle: 'السنع: التعاون وحب الوطن',
    story: `<div class="story-area"><div class="story-text"><strong>قصة: العز والمجد</strong><p>في 2 ديسمبر 1971، اجتمع قادة الإمارات ليبنوا وطنًا واحدًا موحدًا. تعلّمت ميثا كيف تعاون القادة على تجاوز التحديات، وكيف أن حب الوطن والالتزام به هو أساس القوة والوحدة. شعرت بالفخر وهي تسمع قصص التضحيات والعمل المشترك، وفهمت أن الاتحاد ليس مجرد اتفاق سياسي، بل هو درس في التعاون والمحبة والسنع الإماراتي.</p><p style="font-weight:700;margin-top:10px">المثل: "إيد وحده ما تصفّق."</p></div></div>`,
    questions: [
      { q: 'من كان من القادة المشاركين في تأسيس الاتحاد؟', opts: ['الشيخ زايد بن سلطان آل نهيان','شخص آخر','لا أحد'], a: 0, hint: 'ركزي على أهم قادة المؤسسين والذين عملوا سوياً لتحقيق الوحدة.' },
      { q: 'ما أثر الاتحاد على التراث؟', opts: ['زاد الاهتمام بالتراث وتوثيقه','قلّ الاهتمام','ما تغيّر شيء'], a: 0, hint: 'الاتحاد أسس لدولة تعتز بهويتها وماضيها.' },
      { q: 'ما هي الصفة التي عُرف بها قادة الاتحاد، وساهمت في تجاوز التحديات في البداية؟', opts: ['الكسل والتراخي','الحكمة وبعد النظر','الغضب المستمر'], a: 1, hint: 'الصفة التي سمحت لهم بالعمل المشترك هي التفكير السليم للوصول للهدف.' },
      { q: 'ما أهمية "العمل المشترك" في قصة قيام الاتحاد؟', opts: ['لا أهمية له','هو أساس القوة والوحدة للوطن','يسبب المشاكل والفرقة'], a: 1, hint: 'المثل "إيد وحده ما تصفّق" يفسر أهمية العمل الجماعي.' },
      { q: 'ماذا يمثل علم دولة الإمارات في السنع الوطني؟', opts: ['قطعة قماش عادية','رمز للهوية والفخر الوطني والوحدة','زينة مؤقتة'], a: 1, hint: 'العلم هو أعلى رموز الولاء والوطنية.' }
    ]
  },
  // المرحلة 6: ثقافتنا (5 أسئلة)
  6: {
    id: 6,
    title: 'المرحلة 6: ثقافتنا',
    subtitle: 'السنع: تقوية الروابط الاجتماعية',
    story: `<div class="story-area"><div class="story-text"><strong>قصة: ألعاب الماضي</strong><p>اكتشفت ميثا الألعاب القديمة للبنات مثل "الصلّة" و"التيلة". لاحظت ميثا كيف كانت هذه الألعاب تجمع الفتيات معًا، وتعلّمهن التعاون والمرح البسيط. فهمت أن الترفيه زمان كان وسيلة لتقوية الروابط الاجتماعية، وأن السنع يظهر حتى في ألعابنا اليومية.</p><p style="font-weight:700;margin-top:10px">المثل: "اللعب زين إذا ما خلى الدين."</p></div></div>`,
    questions: [
      { q: 'ماذا تعلم الأجداد من لعبة "التيلة" الشعبية؟', opts: ['السرعة والركض','الدقة والتركيز والصبر','فنون الطبخ'], a: 1, hint: 'هذه اللعبة تعتمد على التصويب والتحكم الدقيق.' },
      { q: 'ما هي القيمة التي يعززها المثل الشعبي "الجار قبل الدار"؟', opts: ['أهمية بناء البيوت الكبيرة','احترام الجار ومعاملته بالحسنى','الانعزال عن الجيران'], a: 1, hint: 'المثل يؤكد على الأولوية في العلاقات الإنسانية على الماديات.' },
      { q: 'أي من هذه الألعاب كانت تمارسها البنات قديماً وتعتمد على المهارة اليدوية؟', opts: ['استخدام أجهزة إلكترونية','"الصلّة" التي تستخدم الحجارة الصغيرة','الغناء فقط'], a: 1, hint: 'لعبة الصلة هي اللعبة التراثية الأكثر اعتماداً على المهارة اليدوية بين الفتيات.' },
      { q: 'ما أهمية "الشلّات" والأغاني الشعبية؟', opts: ['لا قيمة لها في العصر الحديث','توثيق للحياة والأحداث والمهن القديمة','مجرد ضوضاء'], a: 1, hint: 'الشلّات كانت طريقة لحفظ التاريخ والقصص والمهن القديمة.' },
      { q: 'متى يكون "اللعب زين" وفقاً للمثل الشعبي في هذه المرحلة؟', opts: ['إذا كان اللعب طول اليوم','إذا ما خلى الدين أو أخّر عن الواجبات','إذا كان اللعب سرياً'], a: 1, hint: 'المثل يضع شرطاً أخلاقياً ودينياً للترفيه.' }
    ]
  },
  // المرحلة 7: بيت التراث (5 أسئلة)
  7: {
    id: 7,
    title: 'المرحلة 7: بيت التراث',
    subtitle: 'السنع: الممارسة والمشاركة',
    story: `<div class="story-area"><div class="story-text"><strong>الختام: سفيرة السنع</strong><p>بعد أن أنهت ميثا جميع المراحل، عادت إلى بيت يدّه فاطمة، حيث جلست للتفكير بكل ما تعلمته. قالت لها اليدّه: "التراث ما يعيش في الكتب فقط، بل يعيش في قلوبنا وأفعالنا اليومية." فهمت ميثا أن السنع الإماراتي ليس مجرد كلمات، بل سلوك وأفعال، وأن المحافظة على التراث تبدأ بتعلمه وممارسته ومشاركته مع الآخرين.</p><p style="font-weight:700;margin-top:10px">المثل: "من لا ماضي له، لا حاضر له."</p></div></div>`,
    questions: [
      { q: 'كيف نحافظ على التراث؟', opts: ['نتعلمه ونمارسه في حياتنا','نتركه في الكتب فقط','ننساه'], a: 0, hint: 'التراث الحي هو الذي يُمارس يومياً.' },
      { q: 'عندما تقول اليدّة: "التراث ما يعيش في الكتب فقط"، فماذا تقصد؟', opts: ['يجب حرق الكتب','يجب ممارسة قيم التراث في حياتنا اليومية','أن التراث مادة دراسية صعبة'], a: 1, hint: 'التراث هو مجموعة من السلوكيات والقيم التي يجب تطبيقها.' },
      { q: 'ما هي القيمة التي تدل عليها عبارة "سفيرة للسنع" التي أصبحت عليها ميثا؟', opts: ['التفاخر بالألقاب','نقل قيم السنع للآخرين والمشاركة بها','الاحتفاظ بالسنع لنفسها'], a: 1, hint: 'السفير هو من ينقل الرسالة والخبرة للآخرين.' },
      { q: 'كيف يرتبط الماضي بالحاضر والمستقبل حسب المثل "من لا ماضي له، لا حاضر له"؟', opts: ['الماضي يُنسى تماماً','الماضي هو الأساس الذي يُبنى عليه المستقبل القوي','الماضي عائق للتقدم'], a: 1, hint: 'التراث يمثل الجذور التي يستند عليها التقدم الحديث.' },
      { q: 'ما هو أهم دور لكِ في الحفاظ على سنع الإمارات؟', opts: ['أنتقد من لا يعرف السنع','أتعلم السنع وأطبقه في تعاملاتي وأحث عليه','أكتفي بالمشاهدة'], a: 1, hint: 'دورك يبدأ بالذات وينتهي بالمجتمع والمشاركة الفعالة.' }
    ]
  }
};

/* ---------- Utility functions ---------- */
function show(screenId){
  Object.values(screens).forEach(s=>s.classList.remove('active'));
  screens[screenId].classList.add('active');
  window.scrollTo(0,0);
}
startBtn.addEventListener('click', ()=> show('map'));


/* stage dots click */
sDots.forEach(dot=>{
  dot.addEventListener('click', ()=>{
    const stage = Number(dot.dataset.stage);
    const playable = (stage === 1) || state.stagesCompleted[stage-1] || state.stagesCompleted[stage] || !dot.classList.contains('locked');
    if(playable) openStage(stage);
    else alert('أكملي المرحلة السابقة أولًا لفتح هذه المرحلة.');
  });
});

function openStage(stageId){
  state.currentStage = stageId;
  if(state.stageProgress[stageId] === undefined) state.stageProgress[stageId] = 0;
  renderStage(stageId);
  show('stage');
}

function renderStage(id){
  const st = STAGES[id];
  stageTitle.textContent = st.title;
  stageSubtitle.textContent = st.subtitle;
  let html = '';
  
  html += `<div class="card">${st.story}</div>`;

  if(st.questions && st.questions.length > 0){
    html += `<div class="card question-area" id="qArea" style="margin-top:10px"></div>`;
  } else {
    html += `<div style="height:12px"></div>`;
  }

  stageContent.innerHTML = html;
  
  if(st.questions && st.questions.length > 0){
    if(state.stageProgress[id] >= st.questions.length || state.stagesCompleted[id]) {
        completeStage(id);
    } else {
        renderQuestionArea(id, state.stageProgress[id]);
    }
  }
}


/* ---------- Questions rendering (5 أسئلة في كل مرحلة) ---------- */
function renderQuestionArea(stageId, qIndex){
  const st = STAGES[stageId];
  const qArea = document.getElementById('qArea');
  if(!qArea) return;
  
  if(qIndex >= st.questions.length){
    completeStage(stageId);
    return;
  }
  
  const q = st.questions[qIndex];
  state.stageProgress[stageId] = qIndex; 

  let html = `<div class="question-title">سؤال ${qIndex+1} من ${st.questions.length}: ${q.q}</div>`;
  html += `<div class="options" id="opts">`;
  q.opts.forEach((opt,idx)=> {
    html += `<button class="option-btn" data-idx="${idx}">${opt}</button>`;
  });
  html += `</div>`;
  
  html += `<div id="hintArea" class="small" style="color:var(--brown);margin-top:10px;display:none;font-weight:700"></div>`;
  html += `<div class="controls"><button id="exitBtn" class="start-btn gray">الخروج للخريطة</button></div>`;
  qArea.innerHTML = html;

  const opts = qArea.querySelectorAll('.option-btn');
  const hintArea = document.getElementById('hintArea');

  opts.forEach(b=>{
    b.addEventListener('click', ()=>{
      opts.forEach(x=> x.disabled = true);
      const idx = Number(b.dataset.idx);
      
      if(idx === q.a){
        b.classList.add('correct');
        hintArea.style.display = 'none';
        
        setTimeout(()=> {
            // الانتقال للسؤال التالي
            renderQuestionArea(stageId, qIndex + 1);
        }, 700);
      } else {
        b.classList.add('wrong');
        
        // عرض رسالة الخطأ والتلميح الصعب
        hintArea.innerHTML = `**إجابة خاطئة. حاول مرة أخرى.**<br>${q.hint}`;
        hintArea.style.display = 'block';

        setTimeout(()=> {
          opts.forEach(x=> x.disabled = false);
          b.disabled = true; 
          b.classList.remove('wrong');
        }, 900);
      }
    });
  });

  document.getElementById('exitBtn').addEventListener('click', ()=> show('map'));
}

/* ---------- Complete stage and medals ---------- */
function completeStage(id){
  if(!state.stagesCompleted[id]){
    state.stagesCompleted[id] = true;
    state.medals += 1;
    progressText.textContent = `وسام السنع ${state.medals}/7`;
    addMedal(STAGES[id].title);
    
    const dot = document.querySelector(`.stage-dot[data-stage='${id}']`);
    if(dot){ 
        dot.style.background = 'linear-gradient(135deg,var(--gold),#ffd27a)'; 
        dot.style.color='#6b3b00'; 
        dot.title = 'منجز'; 
    }
    
    const nextDot = document.querySelector(`.stage-dot[data-stage='${id+1}']`);
    if(nextDot) nextDot.classList.remove('locked');
  }
  
  fbContent.innerHTML = `<div class="badge">✨</div><div style="font-weight:800;margin-top:6px">مبروك! أكملت ${STAGES[id].title}</div><div class="small" style="margin-top:6px">حصلت على +1 وسام</div>`;
  show('feedback');
  fbNext.style.display = 'none'; 
  fbMap.style.display = 'inline-block';
  fbMap.onclick = ()=> { show('map'); fbMap.style.display='none'; };
}

/* add medal to rewards modal */
function addMedal(title){
  const el = document.createElement('div');
  el.style.cssText = 'width:120px;text-align:center';
  el.innerHTML = `<div style="width:80px;height:80px;border-radius:12px;background:linear-gradient(135deg,#ffd27a,#f6c34d);display:flex;align-items:center;justify-content:center;font-weight:800">✨</div><div class="small" style="margin-top:6px">${title}</div>`;
  medalsBox.appendChild(el);
}

/* ---------- Controls ---------- */
exitStage.addEventListener('click', ()=> show('map'));
openRewards.addEventListener('click', ()=> rewardsModal.style.display='flex');
closeRewards.addEventListener('click', ()=> rewardsModal.style.display='none');
document.querySelector(`.stage-dot[data-stage='1']`).classList.remove('locked');

</script>
</body>
</html>
