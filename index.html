<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ุฑุญูุฉ ุณูุน โ ุงููุณุฎุฉ ุงูุฐูุจูุฉ</title>
<style>
:root{
  --gold-bg:#f6e6c9;
  --card:#fffdf8;
  --muted:#6b5a47;
  --gold:#c99b3a;
  --brown:#7b4f2b;
  --accent:#8c5a22;
  font-family: "Noto Naskh Arabic", "Segoe UI", Tahoma, sans-serif;
}
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(180deg,var(--gold-bg),#f2dfb3);color:#2a2a2a;display:flex;align-items:center;justify-content:center;padding:16px}
.app{width:100%;max-width:980px;border-radius:14px;overflow:hidden;background:linear-gradient(180deg,rgba(255,255,255,0.9),rgba(255,255,255,0.97));box-shadow:0 14px 40px rgba(20,20,20,0.08)}
.header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid rgba(0,0,0,0.04);background:linear-gradient(90deg, rgba(201,155,58,0.06), transparent)}
.logo{display:flex;gap:12px;align-items:center}
.logo .icon{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--gold),#ffd27a);display:flex;align-items:center;justify-content:center;font-weight:900;color:#6b3b00;font-size:22px}
.logo h1{margin:0;font-size:20px}
.tag{font-size:12px;color:var(--muted)}
.screen{display:none;padding:18px}
.screen.active{display:block}
.card{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 6px 18px rgba(0,0,0,0.04)}
.small{font-size:12px;color:var(--muted)}
.start-btn{background:linear-gradient(90deg,#b67e2b,#6b3b00);color:#fff;border:none;padding:10px 16px;border-radius:10px;font-weight:800;cursor:pointer}
.start-btn.gray{background:#6b6b6b}
.map-canvas{min-height:420px;border-radius:12px;padding:16px;position:relative;background:linear-gradient(180deg,#fff6e8,#fffaf0)}
.stage-dot{position:absolute;width:96px;height:96px;border-radius:12px;display:flex;align-items:center;justify-content:center;flex-direction:column;font-size:13px;cursor:pointer;background:rgba(255,255,255,0.95);box-shadow:0 6px 18px rgba(0,0,0,0.06);text-align:center;padding:6px}
.stage-dot.locked{filter:grayscale(1);opacity:0.6}
.stage-dot .emoji{font-size:28px}
.stage-dot .label{margin-top:6px;background:rgba(255,255,255,0.9);padding:4px 6px;border-radius:6px;font-size:13px}
#s1{left:6%;top:62%}
#s2{left:28%;top:40%}
#s3{left:48%;top:66%}
#s4{left:70%;top:36%}
#s5{left:84%;top:66%}
#s6{left:40%;top:18%}
#s7{left:72%;top:80%}
.stage-header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:8px}
.stage-title{font-weight:900;font-size:18px}
.story-area{display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap}
.story-text{flex:1}
.story-image{width:180px;border-radius:8px;object-fit:cover;border:2px solid rgba(0,0,0,0.04);background:#fff;padding:6px}
.question-area{margin-top:12px}
.question-title{font-weight:800;margin-bottom:8px}
.options{display:flex;flex-direction:column;gap:10px}
.option-btn{background:#fff;border:2px solid rgba(0,0,0,0.04);padding:12px;border-radius:10px;font-weight:800;cursor:pointer;text-align:right}
.option-btn.correct{border-color:rgba(45,150,45,0.25);background:linear-gradient(90deg,#f3fbf3,#fff)}
.option-btn.wrong{border-color:rgba(200,60,60,0.12);opacity:0.9}
.controls{display:flex;gap:8px;align-items:center;margin-top:10px}
.feedback{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;padding:18px}
.badge{width:86px;height:86px;border-radius:50%;background:linear-gradient(135deg,#ffd27a,#f6c34d);display:flex;align-items:center;justify-content:center;font-size:28px;box-shadow:0 8px 30px rgba(0,0,0,0.08)}
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center}
.modal .box{background:white;padding:16px;border-radius:12px;max-width:700px;width:94%}
@media (max-width:860px){ .story-image{display:none} .stage-dot{width:78px;height:78px} }
.top-info{display:flex;justify-content:space-between;align-items:center;gap:12px;width:100%}
.top-info .left, .top-info .right{font-size:13px;color:var(--muted)}
</style>
</head>
<body>
<div class="app" role="application" aria-label="ุฑุญูุฉ ุณูุน - ุงููุณุฎุฉ ุงูุฐูุจูุฉ">
  <div class="header">
    <div class="logo"><div class="icon">ุณ</div><div><h1>ุฑุญูุฉ ุณูุน</h1><div class="tag">ุฐูุงุก ุงููุณุชูุจู... ุจุณูุน ุงูุฃุฌุฏุงุฏ</div></div></div>
    <div style="width:420px">
      <div class="top-info">
        <div class="right">ูุฑูู ุงูุซููุฏ โ ูุฏุฑุณุฉ ุงูุซููุฏ ููุจูุงุช</div>
        <div class="left">ูุงูุงุซูู ุงูุฅูุงุฑุงุช ุชุจุฑูุฌ</div>
      </div>
    </div>
  </div>

  <section id="splash" class="screen active">
    <div class="card" style="max-width:920px;margin:12px auto;text-align:right">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
        <div style="flex:1;text-align:right">
          <div style="font-weight:900;font-size:26px">ุฑุญูุฉ ุณูุน โ ุงููุณุฎุฉ ุงูุฐูุจูุฉ</div>
          <div class="small" style="margin-top:6px">ุงูุถูู ุฅูู ููุซุง ู"ุชุฑุงุซู" ูู ูุบุงูุฑุฉ ุณุฑูุนุฉ ุชุนูุฏ ููุง ุณูุน ุงูุฃุฌุฏุงุฏ.</div>
        </div>
        <div style="width:220px;text-align:left">
          <img src="sheikhs.png" alt="ุงูุดูุฎ ุฒุงูุฏ ูุงูุดูุฎ ุฑุงุดุฏ" style="width:100%;height:110px;object-fit:cover;border-radius:8px" onerror="this.style.display='none'"/>
        </div>
      </div>

      <div style="margin-top:12px;padding:12px;border-radius:10px;background:linear-gradient(90deg, rgba(201,155,58,0.06), transparent);text-align:right">
        <div style="font-weight:800;margin-bottom:6px">ุจูุงูุงุช ุงููุฑูู ูููุณุงุจูุฉ</div>
        <div class="small"><strong>ุงููุณุงุจูุฉ:</strong> ูุงูุงุซูู ุงูุฅูุงุฑุงุช ุชุจุฑูุฌ</div>
        <div class="small"><strong>ุงููุฏุฑุณุฉ:</strong> ูุฏุฑุณุฉ ุงูุซููุฏ ููุจูุงุช</div>
        <div class="small" style="margin-top:8px"><strong>ุฃุณูุงุก ุงูุทุงูุจุงุช:</strong></div>
        <ul style="margin:6px 0 0 0;padding-left:18px;text-align:right">
          <li>ุฑูู ุณุงูู</li>
          <li>ุงูุฑูู ุฎุงูุฏ</li>
          <li>ุดูุงูู ุนุจุฏุงููู</li>
          <li>ุนุฒู ุงุญูุฏ</li>
        </ul>
      </div>

      <div style="margin-top:14px;text-align:center">
        <p style="margin:6px 0">ูู ุตุจุงุญู ูุดูุณ ูุตูุช ููุซุง ุฅูู ุจูุช ูุฏูุชูุง ูุงุทูุฉโฆ ูุจูู ุฑุงุฆุญุฉ ุงููููุฉ ูุตูุช ุงูููุจุงุด ูุฌุฏุช ุฌูุงุฒูุง ูุฏูููุง ุงุณูู "ุชุฑุงุซู". ูุงู ููุง: <em>ุณุงุนุฏููู ุฃุณุชุนูุฏ ุณูุน ุงูุฃุฌุฏุงุฏ!</em></p>
        <div style="display:flex;gap:10px;justify-content:center;margin-top:10px">
          <button class="start-btn" id="startBtn">ุงุจุฏุฃ ุงูุฑุญูุฉ</button>
          <button class="start-btn gray" id="downloadBtn">ุชุญููู ุงููุณุฎุฉ (ZIP)</button>
        </div>
        <div class="small" style="margin-top:8px">ุงููุนุจุฉ: 7 ูุฑุงุญู โข ุฃุณุฆูุฉ ุชูุงุนููุฉ โข ูุตุต ุดุนุจูุฉ โข ุฒุฑ ุฎุฑูุฌ ููุฎุฑูุทุฉ ูู ูู ุณุคุงู</div>
      </div>
    </div>
  </section>

  <section id="map" class="screen">
    <div class="card" style="padding:12px">
      <div style="display:flex;justify-content:flex-end;margin-bottom:10px;">
        <button id="homeBtn" class="start-btn gray" style="padding:8px 12px;font-size:13px">ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ๐</button>
      </div>
      <div class="map-canvas card">
        <svg width="100%" height="100%" style="position:absolute;left:0;top:0;z-index:0" viewBox="0 0 1100 700" preserveAspectRatio="none"><rect width="100%" height="100%" fill="#fff7ea"/></svg>
        <div id="s1" class="stage-dot" data-stage="1"><div class="emoji">๐</div><div class="label">ูุฌูุณ ุงููุฏูู</div></div>
        <div id="s2" class="stage-dot locked" data-stage="2"><div class="emoji">๐บ</div><div class="label">ุงูุณูู ุงููุฏูู</div></div>
        <div id="s3" class="stage-dot locked" data-stage="3"><div class="emoji">๐ด</div><div class="label">ุงููุฒุฑุนุฉ</div></div>
        <div id="s4" class="stage-dot locked" data-stage="4"><div class="emoji">๐ชจ</div><div class="label">ุขุซุงุฑ ุงูุฃุฌุฏุงุฏ</div></div>
        <div id="s5" class="stage-dot locked" data-stage="5"><div class="emoji">๐ฆ๐ช</div><div class="label">ููุงู ุงูุงุชุญุงุฏ</div></div>
        <div id="s6" class="stage-dot locked" data-stage="6"><div class="emoji">๐ญ</div><div class="label">ุซูุงูุชูุง</div></div>
        <div id="s7" class="stage-dot locked" data-stage="7"><div class="emoji">๐ก</div><div class="label">ุจูุช ุงูุชุฑุงุซ</div></div>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;padding-top:10px">
        <div><div class="small">ุฃูุณูุฉ ููุชุณุจุฉ</div><div id="progressText" class="small" style="font-weight:800">ูุณุงู ุงูุณูุน 0/7</div></div>
        <div><button id="openRewards" class="start-btn" style="padding:8px 12px;font-size:13px">ููู ุฅูุฌุงุฒ ููุซุง</button></div>
      </div>
    </div>
  </section>

  <section id="stageScreen" class="screen">
    <div class="card">
      <div class="stage-header">
        <div>
          <div class="stage-title" id="stageTitle">ุงููุฑุญูุฉ</div>
          <div class="small" id="stageSubtitle">ูุตู ูุตูุฑ</div>
        </div>
        <div>
          <button id="exitStage" class="start-btn gray">ุงูุฎุฑูุฌ ููุฎุฑูุทุฉ</button>
        </div>
      </div>
      <div id="stageContent"></div>
    </div>
  </section>

  <section id="feedback" class="screen">
    <div class="card feedback">
      <div id="fbContent"></div>
      <div style="display:flex;gap:8px;margin-top:12px">
        <button id="fbNext" class="start-btn" style="display:none">ุงูุชุงูู</button>
        <button id="fbMap" class="start-btn gray" style="display:none">ุงูุนูุฏุฉ ููุฎุฑูุทุฉ</button>
      </div>
    </div>
  </section>

  <div id="rewardsModal" class="modal" style="display:none">
    <div class="box"><div class="card"><h3 style="margin-top:0">ููู ุฅูุฌุงุฒ ููุซุง</h3><div id="medalsBox" style="display:flex;gap:8px;flex-wrap:wrap"></div><div style="margin-top:12px;text-align:left"><button id="closeRewards" class="start-btn">ุฃุบูู</button></div></div></div>
  </div>

  <div class="footer card" style="margin:12px">ูููุฐุฌ ุฃููู โข ููุฏู ูู ูุฑูู ูุฏุฑุณุฉ ุงูุซููุฏ ููุจูุงุช</div>
</div>

<script>
/* ---------- State & DOM ---------- */
const screens = { splash: document.getElementById('splash'), map: document.getElementById('map'), stage: document.getElementById('stageScreen'), feedback: document.getElementById('feedback') };
const startBtn = document.getElementById('startBtn');
const downloadBtn = document.getElementById('downloadBtn');
const homeBtn = document.getElementById('homeBtn'); // ุฒุฑ ุงูุนูุฏุฉ ููุตูุญุฉ ุงูุฑุฆูุณูุฉ
const sDots = document.querySelectorAll('.stage-dot');
const exitStage = document.getElementById('exitStage');
const stageContent = document.getElementById('stageContent');
const stageTitle = document.getElementById('stageTitle');
const stageSubtitle = document.getElementById('stageSubtitle');
const fbContent = document.getElementById('fbContent');
const fbNext = document.getElementById('fbNext');
const fbMap = document.getElementById('fbMap');
const progressText = document.getElementById('progressText');
const rewardsModal = document.getElementById('rewardsModal');
const openRewards = document.getElementById('openRewards');
const closeRewards = document.getElementById('closeRewards');
const medalsBox = document.getElementById('medalsBox');

let state = { currentStage: null, medals: 0, stagesCompleted: {1:false,2:false,3:false,4:false,5:false,6:false,7:false}, stageProgress: {} };

/* ---------- Stage Content (ุงููุญุชูู ุงููุญุฏุซ) ---------- */
const STAGES = {
  // ุงูุชุนุฏูู 1: ุงููุฑุญูุฉ 1 - ุขุฏุงุจ ุงููุฌูุณ
  1: {
    id: 1,
    title: 'ุงููุฑุญูุฉ 1: ุขุฏุงุจ ุงููุฌูุณ',
    subtitle: 'ุงูุณูุน: ุฅูุฑุงู ุงูุถูู',
    story: `<div class="story-area"><div class="story-text"><strong>ูุตุฉ: ุงูุถูู ุงููุฑูู</strong><p>ูู ูููู ูู ุงูุฃูุงูุ ุฏุฎู ุถูู ูุจูุฑ ุฅูู ูุฌูุณ ูุฏูู ูุงุทูุฉ. ุฑุญูุจ ุจู ุงูุฌููุน ุจุญุฑุงุฑุฉ ููุฏูููุง ูู ุงููููุฉ ุจุงููุฏ ุงูููููุ ููุง ุนููุชูู ุงูุนุงุฏุงุช ุงูุฅูุงุฑุงุชูุฉ ุงููุฏููุฉ. ุฌูุณุช ููุซุง ุชุฑุงูุจ ูู ุญุฑูุฉุ ููุงุญุธุช ููู ุฃู ุงุจุชุณุงูุฉ ุงูุชุฑุญูุจ ููุจุฑุฉ ุงูุตูุช ุงููุงุฏุฆุฉ ุชุฌุนู ุงูุถูู ูุดุนุฑ ุจุงูุฑุงุญุฉ ูุงูุงุญุชุฑุงู. ุชุนููุช ุฃู ุงุญุชุฑุงู ุงููุจูุฑ ูุงูุชุฑุญูุจ ุจุงูุถูู ูู ุฃุณุงุณ ุงูุณูุนุ ูุฃู ุงููุฑู ูุง ููุชูู ุฅูุง ุจุงูููุฉ ุงูุทูุจุฉ.</p><p style="font-weight:700;margin-top:10px">ุงููุซู: "ุงูุถูู ุถูู ุงูููุ ูุงููุฑู ูู ุดูู ุงูุนุฑุจ."</p></div></div>`,
    questions: [
      { q: 'ููููุง ููุณูุน ุงูุฅูุงุฑุงุชู ุงูุฐู ุชุนูููุชู ููุซุง ูู ูุฌูุณ ุงููุฏูุฉุ ูุง ูู ุงููุฏ ุงูุชู ูุฌุจ ุฃู ุชูุณุชุฎุฏู ูุชูุฏูู ุงููููุฉ ููุถููุ', opts: ['ุงููุฏ ุงููุณุฑู', 'ุงููุฏ ุงููููู', 'ููุชุง ุงููุฏูู'], a: 1, hint: 'ุชุฐููุฑ ุฃู ุงููุฏ ุงูุชู ุชุนุทู ูู ุงูุฃูุฑูุ ูุงูุนุฑุจ ุชููุถููุง ูู ุงููุฑู ูุงูุณูุน.' },
      { q: 'ูุง ูู ุฃูุถู ุชุนุจูุฑ ูุตู "ุงูุณูุน" ูู ูุฐู ุงููุฑุญูุฉุ', opts: ['ุงูุชุนุงูู ูู ุงูุนูู', 'ุฅูุฑุงู ุงูุถูู ูุงูุชุฑุญูุจ ุจู', 'ุงููุญุงูุธุฉ ุนูู ุงูุจูุฆุฉ'], a: 1, hint: 'ุฑููุฒ ุนูู ุงูุดุทุฑ ุงูุฃูู ูู ุงููุซูุ ูููู ููุฉ ุงูุชุฑุญูุจ ูุงูุชูุฏูุฑ.' },
      { q: 'ุฅุฐุง ุฏุฎูุช ูุฌูุณูุง ูููู ูุฌููุนุฉ ูู ูุจุงุฑ ุงูุณูุ ุฃู ุงูุชุตุฑูุงุช ุงูุชุงููุฉ ูู ุงูุฃุตูุจ ููููุง ูุขุฏุงุจ ุงููุฌูุณุ', opts: ['ุงูุฌููุณ ููุฑูุง ูู ุงูููุนุฏ ุงูุฐู ูุนุฌุจูู', 'ุฅููุงุก ุงูุชุญูุฉ ุจุตูุช ูุฑุชูุน ูุงูุงูุชุธุงุฑ ุญุชู ูุฏุนููู ููุฌููุณ', 'ุงูุจุฏุก ูู ุงุณุชุฎุฏุงู ุงููุงุชู ููุฑูุง'], a: 1, hint: 'ุงูุงุญุชุฑุงู ูุจุฏุฃ ุจุงูุงุณุชุฆุฐุงู ูุจู ุงูุฌููุณุ ููุฐุง ุงูุณูุน ูู ุงูุฃููููุฉ.' }
    ]
  },
  // ุงูุชุนุฏูู 1: ุงููุฑุญูุฉ 2 - ุงูุณูู ุงููุฏูู
  2: {
    id: 2,
    title: 'ุงููุฑุญูุฉ 2: ุงูุณูู ุงููุฏูู',
    subtitle: 'ุงูุณูุน: ุงูุฃูุงูุฉ ูุงูุตุฏู',
    story: `<div class="story-area"><div class="story-text"><strong>ูุตุฉ: ุงูุชุงุฌุฑ ุงูุตุงุฏู</strong><p>ุฐูุจุช ููุซุง ุฅูู ุงูุณูู ุงููุฏููุ ุญูุซ ุฑุงุฆุญุฉ ุงูุจูุงุฑุงุช ูุงูุชููุฑ ุชููุฃ ุงูููุงู. ุฑุฃุช ุงูุจุงุฆุนูู ูุชุจุงุฏููู ุงูุชุญูุฉ ูุงูุงุจุชุณุงูุงุช ูุน ุงูุฒุจุงุฆูุ ูุดุงูุฏุช ุจุงุฆุนูุง ูุนูุฏ ูุฒุจูู ูุณู ุงูุฒูุงุฏุฉ ุจุงูุบูุท. ูุงุญุธุช ุฃู ุงูุฃูุงูุฉ ูุงูุตุฏู ูุงููุง ุฒููุฉ ุงูุชุงุฌุฑุ ูุฃู ุงูุชุนุงูู ุจุงูุนุฏู ูุฌุนู ุงููุงุณ ุชุญุจู ูุชุซู ููู. ูููุช ุฃู ุงูุณูุน ูุง ููุชุตุฑ ุนูู ุงููุฌุงูุณุ ุจู ูุดูู ูู ุชุนุงููุงุชูุง ุงูููููุฉ.</p><p style="font-weight:700;margin-top:10px">ุงููุซู: "ุงูุตุฏู ุฒููุ ูุงููุฐุจ ุดูู."</p></div></div>`,
    questions: [
      { q: 'ูุง ูู ุงูุตูุงุช ุงูุชู ุฌุนูุช ุงููุงุณ ุชุซู ุจุงูุชุงุฌุฑ ูุชุญุจู ูู ุงูุณูู ุงููุฏููุ', opts: ['ุงููุธูุฑ ุงูุซููู', 'ุงูุฃูุงูุฉ ูุงูุตุฏู ูู ุงูุชุนุงูู', 'ุงููุฏุฑุฉ ุนูู ูุณุงููุฉ ุงูุฒุจูู'], a: 1, hint: 'ุฃูู ููู ุงููุซู ุฃู ุงููุฐุจ ูู ุฃุณูุฃ ูุง ููููุ ุงูุตูุฉ ุงููุถุงุฏุฉ ูู ุงููุทููุจุฉ.' },
      { q: 'ูุง ูู ุงูุชุตุฑู ุงูุฐู ูุชูุงุดู ูุน ุงูุณูุน ูู ุงูุชุนุงููุงุช ุงูุชุฌุงุฑูุฉ ุงูููููุฉุ', opts: ['ุงููุจุงูุบุฉ ูู ูุตู ุงูุจุถุงุนุฉ ูุฌุฐุจ ุงูุฒุจูู', 'ุงูุงูุชุฒุงู ุจุงููุนุฏ ูููู ุงูุญูููุฉ ุนู ุฌูุฏุฉ ุงูุณูุนุฉ', 'ุชูุฏูู ุงููุฏุงูุง ูุชูุงุฏู ุงูุดูุงูู'], a: 1, hint: 'ุงููุฒุงูุฉ ูู ุงูุณูู ุงููุฏูู ูุงูุช ุจูุซุงุจุฉ ุนูุฏ ุบูุฑ ููุชูุจ ุจูู ุงูุชุงุฌุฑ ูุงูุฒุจูู.' },
      { q: 'ุฑุฃูุช ูุจูุบูุง ูู ุงููุงู ุณูุท ูู ูุญูุธุฉ ุดุฎุต ุฏูู ุฃู ููุงุญุธุ ูุง ูู ุงูุณูุน ุงูุตุญูุญ ูู ูุฐุง ุงูููููุ', opts: ['ุชุฌุงูู ุงููุงู ูุงูุงุจุชุนุงุฏ', 'ุฃุฎุฐ ุงููุงู ูุฃูู ูู ููุงุญุธ', 'ุชูุจูู ุงูุดุฎุต ูุฅุนุงุฏุฉ ุงููุงู ูู ููุฑูุง'], a: 2, hint: 'ุงุณุชุฑุฌุน ูุตุฉ ุงูุชุงุฌุฑ ุงูุฐู ุฃุนุงุฏ ุงูุฒูุงุฏุฉ ุจุงูุบูุท... ุงููููู ูุดุจูู ุชูุงููุง.' }
    ]
  },
  // ุงูุชุนุฏูู 1: ุงููุฑุญูุฉ 3 - ุงููุฒุฑุนุฉ
  3: {
    id: 3,
    title: 'ุงููุฑุญูุฉ 3: ุงููุฒุฑุนุฉ',
    subtitle: 'ุงูุณูุน: ุงูุตุจุฑ ูุงูุนุทุงุก',
    story: `<div class="story-area"><div class="story-text"><strong>ูุตุฉ: ุงููุฎูุฉ ูุงูุฃุฌุฏุงุฏ</strong><p>ุฒุงุฑุช ููุซุง ุงููุฒุฑุนุฉ ูุน ุฌุฏูุงุ ูุดุงูุฏุช ุงููุฎูู ุงูุทููู ุงูููุชุฏ ูู ุตููู ููุธูุฉ. ุณุงุนุฏุช ุฌุฏูุง ูู ุณูู ุงููุณุงุฆู ุงูุตุบูุฑุฉุ ูุชุนููุช ุฃู ูู ุดุฌุฑุฉ ุชุญุชุงุฌ ุฅูู ุตุจุฑ ูุนูุงูุฉ. ูุงู ููุง ุฌุฏูุง: "ุงููุฎูุฉ ูุซู ุงูุฅูุณุงูุ ุฅุฐุง ุงูุชูููุช ูููุง ูุฃุนุทูุชูุง ุญุจู ูููุชูุ ุชุนุทูู ุฎูุฑูุง." ูููุช ููุซุง ุฃู ุงูุฒุฑุงุนุฉ ููุณุช ููุท ุนูููุง ุฌุณุฏููุงุ ุจู ุฏุฑุณ ูู ุงูุตุจุฑ ูุงูุนุทุงุก ูุงูุณูุน ุงูุฅูุงุฑุงุชู ุงูุฃุตูู.</p><p style="font-weight:700;margin-top:10px">ุงููุซู: "ุงูุฒุฑุน ูู ุจุฐุฑูุ ูุงููุฑู ูู ุฃุตูู."</p></div></div>`,
    questions: [
      { q: 'ูุง ูู ุงูุฏุฑุณ ุงูุฃุณุงุณู ุงูุฐู ุชุนููุชู ููุซุง ุนู ุงููุฎูุฉ ูุนู ุงูุณูุนุ', opts: ['ุฃู ุงููุฎูุฉ ุชุนุทู ุซูุงุฑูุง ุจุณุฑุนุฉ ุฏูู ุฌูุฏ', 'ุฃู ุงููุฎูุฉ ุชุญุชุงุฌ ุฅูู ุตุจุฑ ูุนูุงูุฉ ูุชุนุทู ุฎูุฑูุง', 'ุฃู ุงููุฎูุฉ ูุง ุชุญุชุงุฌ ุฅูู ูุงุก ูุซูุฑ'], a: 1, hint: 'ุงูุฌุฏ ุฑุจุท ุจูู ุนุทุงุก ุงููุฎูุฉ ูุนุทุงุก ุงูุฅูุณุงูุ ูููุงููุง ูุญุชุงุฌ ุฅูู ูุฏุฉ ุทูููุฉ ูุซุงุจุชู ูู ุงูุงูุชูุงู.' },
      { q: 'ูุงุฐุง ูุนูู ูุฐุง ุงููุซู ูู ุณูุงู ุงูุณูุน ูุชุฑุจูุฉ ุงูุฃุจูุงุกุ', opts: ['ุฃู ุงูุฎูุฑ ูุฃุชู ููุท ูู ุงูุจุฐูุฑ ุงูุบุงููุฉ', 'ุฃู ุงูุฃุฎูุงู ูุงููุฑู ุชูุจุน ูู ุฃุตูู ูุชุฑุจูุฉ ุตุงูุญุฉ', 'ุฃู ุงูุฒุฑุงุนุฉ ุฃูู ูู ุงูุชุฑุจูุฉ'], a: 1, hint: 'ุงูุฃุตู ููุง ูุง ูุนูู ุงูููุงู... ุจู ูุนูู ุงูุฃุณุงุณ ูุงููุดุฃุฉ.' },
      { q: 'ูุง ูู ุงููููุฉ ุงูุชู ุชูุซููุง ุงูุนูุงูุฉ ุจูู ุงูุฃุฌุฏุงุฏ ูุงูุฃุฑุถ (ุงููุฒุฑุนุฉ) ูู ุงูุชุฑุงุซ ุงูุฅูุงุฑุงุชูุ', opts: ['ุงููุณู ูุงูุฑุงุญุฉ', 'ุงูุตุจุฑ ูุงูุนุทุงุก ูุญุจ ุงูุฃุฑุถ', 'ุงูุงุณุชููุงู ุงูุณุฑูุน ููููุงุฑุฏ'], a: 1, hint: 'ุงูุนูุงูุฉ ูุน ุงูุฃุฑุถ ูู ุชูู ูููุงู ุณุฑูุนุฉ... ุจู ูุงูุช ุนูุงูุฉ ุทูููุฉ ุงูุฃูุฏ ูููุฌููุฏุฉ.' }
    ]
  },
  // ุงูุชุนุฏูู 1: ุงููุฑุญูุฉ 4 - ุขุซุงุฑ ุงูุฃุฌุฏุงุฏ (ุงูุงุณู ูุงููุตุฉ ูุงูุฃุณุฆูุฉ)
  4: {
    id: 4,
    title: 'ุงููุฑุญูุฉ 4: ุขุซุงุฑ ุงูุฃุฌุฏุงุฏ',
    subtitle: 'ุงูุณูุน: ุงุญุชุฑุงู ุงููุงุถู ูุงูุชุนูู ููู',
    story: `<div class="story-area"><div class="story-text"><strong>ูุตุฉ: ูุชุญู ูููุญุฉ</strong><p>ุฒุงุฑุช ููุซุง ูุชุญู ูููุญุฉุ ุญูุซ ุนุฑุถุช ุงูุฑุณููุงุช ูุงููููุด ุงููุฏููุฉ ุงูุชู ุชุญูู ุญูุงุฉ ุงูุฃุฌุฏุงุฏ. ุฑุฃุช ุงููููุด ุงูุชู ุชุตูุฑ ุฌูุงู ุงูุตุญุฑุงุก ูุงูุตูุงุฏูู ูุงูุฌูุงูุ ููุงุญุธุช ููู ุงุณุชุฎุฏู ุงูุฃุฌุฏุงุฏ ูุฐู ุงูุฑุณููุงุช ูุชูุซูู ุญูุงุชูู ูุญูุงูุงุชูู. ุดุนุฑุช ููุซุง ุจุงูุฏูุดุฉ ูุงูุฅุนุฌุงุจุ ููููุช ุฃู ุงูุณูุน ุงูุญูููู ูููู ูู ุงุญุชุฑุงู ุงููุงุถู ูุชุนูู ุงูุญูู ูู ุชุฌุงุฑุจ ุงูุฃุฌุฏุงุฏ.</p><p style="font-weight:700;margin-top:10px">ุงููุซู: "ูู ุญูุธ ูุฏูููุ ุฃูู ูู ุฌุฏูุฏู."</p></div></div>`,
    questions: [
      { q: 'ููุงุฐุง ูุงู ุงูุฃุฌุฏุงุฏ ูููููู ุจุงูุฑุณููุงุช ูุงููููุด ุนูู ุงูุตุฎูุฑุ', opts: ['ุนุดุงู ูุชูุงุฎุฑูู', 'ูุชูุซูู ูุตุตูู ูุญูุงุชูู ููุฃุฌูุงู ุงููุงุฏูุฉ', 'ููุฒููุฉ ููุท'], a: 1, hint: 'ุฅุฐุง ุญูุธูุง ุงููุฏูู... ููุง ูู ุงูุฏูุฑ ุงูุฐู ุชูุนุจู ูุฐู ุงููููุด ูู ุญูุธูุ' },
      { q: 'ููู ูููู ุชุทุจูู ุงููุซู "ูู ุญูุธ ูุฏูููุ ุฃูู ูู ุฌุฏูุฏู" ูู ุญูุงุชูุงุ', opts: ['ุฃู ุชุชุฌุงูู ูู ุงูุชูููููุฌูุง ุงูุญุฏูุซุฉ', 'ุฃู ุชุญุชุฑู ุงููุงุถู ูุชุชุนูู ูู ุญูู ุงูุฃุฌุฏุงุฏ ูุชูุงุฌู ุงููุณุชูุจู ุจุซูุฉ', 'ุฃู ุชุจูู ูู ุงููุงุถู ููุง ุชููุฑ ูู ุงููุณุชูุจู'], a: 1, hint: 'ูููุฉ "ุฃูู" ูู ููุชุงุญ ุงูุญู... ููู ูููู ุงููุงุถู ูุตุฏุฑุงู ููุฃูุงู ูููุณุชูุจูุ' },
      { q: 'ุฒูุงุฑุฉ ุงูููุงูุน ุงูุฃุซุฑูุฉ ูุงููุชุงุญู ุฌุฒุก ูู ุงูุณูุน. ูุง ูู ุงูุชุตุฑู ุงูุตุญูุญ ุนูุฏ ุงูุชุนุงูู ูุน ุงูุขุซุงุฑ ุงููุฏููุฉุ', opts: ['ููุณูุง ูุงููุชุงุจุฉ ุนูููุง ููุชุฐูุงุฑ', 'ุงููุญุงูุธุฉ ุนูููุง ูุงุญุชุฑุงู ูููุชูุง ุงูุชุงุฑูุฎูุฉ', 'ุฃุฎุฐ ูุทุนุฉ ุตุบูุฑุฉ ูููุง ููุฏูุฉ'], a: 1, hint: 'ุงุญุชุฑุงู ุงููุงุถู ูุจุฏุฃ ุจุญูุงูุฉ ุขุซุงุฑู... ููุง ูู ุฏูุฑู ูู ุญูุงูุชูุงุ' }
    ]
  },
  // ุงูุชุนุฏูู 1: ุงููุฑุญูุฉ 5 - ููุงู ุงูุงุชุญุงุฏ
  5: {
    id: 5,
    title: 'ุงููุฑุญูุฉ 5: ููุงู ุงูุงุชุญุงุฏ',
    subtitle: 'ุงูุณูุน: ุงูุชุนุงูู ูุญุจ ุงููุทู',
    story: `<div class="story-area"><div class="story-text"><strong>ูุตุฉ: ุงูุนุฒ ูุงููุฌุฏ</strong><p>ูู 2 ุฏูุณูุจุฑ 1971ุ ุงุฌุชูุน ูุงุฏุฉ ุงูุฅูุงุฑุงุช ููุจููุง ูุทููุง ูุงุญุฏูุง ููุญุฏูุง. ุชุนูููุช ููุซุง ููู ุชุนุงูู ุงููุงุฏุฉ ุนูู ุชุฌุงูุฒ ุงูุชุญุฏูุงุชุ ูููู ุฃู ุญุจ ุงููุทู ูุงูุงูุชุฒุงู ุจู ูู ุฃุณุงุณ ุงูููุฉ ูุงููุญุฏุฉ. ุดุนุฑุช ุจุงููุฎุฑ ููู ุชุณูุน ูุตุต ุงูุชุถุญูุงุช ูุงูุนูู ุงููุดุชุฑูุ ููููุช ุฃู ุงูุงุชุญุงุฏ ููุณ ูุฌุฑุฏ ุงุชูุงู ุณูุงุณูุ ุจู ูู ุฏุฑุณ ูู ุงูุชุนุงูู ูุงููุญุจุฉ ูุงูุณูุน ุงูุฅูุงุฑุงุชู.</p><p style="font-weight:700;margin-top:10px">ุงููุซู: "ุฅูุฏ ูุญุฏู ูุง ุชุตููู."</p></div></div>`,
    questions: [
      { q: 'ูุง ูู ุงูุฃุณุงุณ ุงูุฐู ูุงู ุนููู ุจูุงุก ุฏููุฉ ุงูุฅูุงุฑุงุช ุงูุนุฑุจูุฉ ุงููุชุญุฏุฉุ', opts: ['ุงูุชูุงูุณ ุงูุดุฏูุฏ ุจูู ุงููุงุฏุฉ', 'ุงูุชุนุงูู ูุงููุญุจุฉ ูุญุจ ุงููุทู ุงููุดุชุฑู', 'ูุฑุงุฑ ุดุฎุต ูุงุญุฏ ููุท'], a: 1, hint: 'ุชุฐูุฑ ุฃู ุงููุงุฏุฉ "ุงุฌุชูุนูุง" ูุชุฌุงูุฒ ุงูุชุญุฏูุงุชุ ููุงุฐุง ูุนูู ุงูุงุฌุชูุงุนุ' },
      { q: 'ูุงุฐุง ุชุนูู ูุฐู ุงูุนุจุงุฑุฉ ูู ุณูุงู ููุงู ุงูุงุชุญุงุฏุ', opts: ['ุฃู ุงูุนูู ุงูุฌูุงุนู ูุง ูุงุฆุฏุฉ ููู', 'ุฃู ุงููุญุฏุฉ ูุงูุชุนุงูู ููุง ุณุฑ ุงูููุฉ ูุงููุฌุงุญ', 'ุฃู ูู ูุงุฆุฏ ูุนูู ุจููุฑุฏู'], a: 1, hint: 'ุงูุชุตููู ูุง ูุชู ุฅูุง ุจู "ุงุซููู" ุนูู ุงูุฃูู... ููุฑ ูู ุงููุนูู ุงููุฒุฏูุฌ.' },
      { q: 'ูู ุงูุณูุน ุงูุฅูุงุฑุงุชูุ ุนูุฏูุง ููุงุฌู ูุฑููู ุชุญุฏููุงุ ูุง ูู ุงูุชุตุฑู ุงูุฐู ูุนูุณ ูููุฉ ุงูุชุนุงููุ', opts: ['ุงูุงุจุชุนุงุฏ ุนู ุงููุฑูู ูุชุฑูู ูุญู ุงููุดููุฉ ุจููุฑุฏู', 'ุงููุณุงุนุฏุฉ ูุงูุนูู ูุน ุงูุฌููุน ุจุฑูุญ ุงููุฑูู ุงููุงุญุฏ', 'ุฅููุงุก ุงูููู ุนูู ุงูุขุฎุฑูู'], a: 1, hint: 'ุงูุฑูุญ ุงููุงุญุฏุฉ ูู ุงูุชู ุชุญูู ุงูุฃูุฏู ุงููููุฑุฏุฉ ุฅูู ูุฏ ุชุตูุน ุงููุณุชุญูู.' }
    ]
  },
  // ุงูุชุนุฏูู 1: ุงููุฑุญูุฉ 6 - ุซูุงูุชูุง
  6: {
    id: 6,
    title: 'ุงููุฑุญูุฉ 6: ุซูุงูุชูุง',
    subtitle: 'ุงูุณูุน: ุชูููุฉ ุงูุฑูุงุจุท ุงูุงุฌุชูุงุนูุฉ',
    story: `<div class="story-area"><div class="story-text"><strong>ูุตุฉ: ุฃูุนุงุจ ุงููุงุถู</strong><p>ุงูุชุดูุช ููุซุง ุงูุฃูุนุงุจ ุงููุฏููุฉ ููุจูุงุช ูุซู "ุงูุตููุฉ" ู"ุงูุชููุฉ" ู"ุงูุบููุฉ (ุงูุบููุถุฉ)" โ ููู ูุนุจุฉ ุงุฎุชุจุงุก ูุดููุฑุฉุ ุญูุซ ุชูุนุตุจ ุนูู ุฅุญุฏู ุงููุชูุงุช (ุงูุบุงููุฉ) ูุชุจุฏุฃ ุงูุจุญุซ ุนู ุฒูููุงุชูุง ุงููุฎุชุจุฆุงุช ุจุงูุงุนุชูุงุฏ ุนูู ุงูุณูุน. ูุงุญุธุช ููุซุง ููู ูุงูุช ูุฐู ุงูุฃูุนุงุจ ุชุฌูุน ุงููุชูุงุช ูุนูุงุ ูุชุนููููู ุงูุชุนุงูู ูุงููุฑุญ ุงูุจุณูุท. ูููุช ุฃู ุงูุชุฑููู ุฒูุงู ูุงู ูุณููุฉ ูุชูููุฉ ุงูุฑูุงุจุท ุงูุงุฌุชูุงุนูุฉุ ูุฃู ุงูุณูุน ูุธูุฑ ุญุชู ูู ุฃูุนุงุจูุง ุงูููููุฉ.</p><p style="font-weight:700;margin-top:10px">ุงููุซู: "ุงููุนุจ ุฒูู ุฅุฐุง ูุง ุฎูู ุงูุฏูู."</p></div></div>`,
    questions: [
      { q: 'ูุง ูู ุงูุฏูุฑ ุงูุงุฌุชูุงุนู ุงูุฐู ูุงูุช ุชูุนุจู ุงูุฃูุนุงุจ ุงููุฏููุฉ ูุซู "ุงูุบููุฉ"ุ', opts: ['ูุถุงุก ุงูููุช ุจููุฑุฏูุง', 'ุชูููุฉ ุงูุฑูุงุจุท ุงูุงุฌุชูุงุนูุฉ ูุชุนููู ุงูุชุนุงูู ูุงููุฑุญ ุงูุจุณูุท', 'ุงูููุงูุณุฉ ุงูุดุฏูุฏุฉ ูุชุญุฏูุฏ ุงููุงุฆุฒ'], a: 1, hint: 'ุงูุฃูุนุงุจ ุงููุฏููุฉ ูู ุชูู ูุฑุฏูุฉุ ูุงูุช ุชุฌููุน ุงููุชูุงุช ุฏุงุฆูุงูุ ููุง ูู ุงููุบุฒูุ' },
      { q: 'ูุง ูู ุดุฑุท "ุงูุณูุน" ูู ูุฐุง ุงููุซูุ', opts: ['ุฃู ููุนุจ ููุท ุงูุฃูุนุงุจ ุงูุฅููุชุฑูููุฉ', 'ุฃู ูููู ุงููุนุจ ูุณููุฉ ูููุฑุญ ูุงูุชุนุงูู ุฏูู ุงูุฅุฎูุงู ุจุงููุงุฌุจุงุช ุงูุฏูููุฉ ูุงูุฃุฎูุงููุฉ', 'ุฃู ููุนุจ ุทูุงู ุงูููู ูููุณู ูู ุดูุก ุขุฎุฑ'], a: 1, hint: 'ุงููุซู ูุถุน "ุฎุทุงู ุฃุญูุฑ" ูุฌุจ ุนุฏู ุชุฌุงูุฒู... ูุง ูู ูุฐุง ุงูุฎุทุ' },
      { q: 'ูู ุงูุชุฌูุนุงุช ุงูุนุงุฆููุฉุ ูุง ูู ุงูุณูุน ูู ุงูุชุนุงูู ูุน ุงูุฃุทูุงู ุงูุฃุตุบุฑ ุณููุงุ', opts: ['ุชุฌุงูููู ูุชุฑููู ููุนุจูู ุจููุฑุฏูู', 'ูุดุงุฑูุชูู ุงููุนุจ ูุงูุงูุชูุงู ุจูู ูุฌุฒุก ูู ุงูุณูุน ุงูุงุฌุชูุงุนู', 'ุชูุจูุฎูู ุฅุฐุง ุฃุญุฏุซูุง ุถูุถุงุก'], a: 1, hint: 'ุงูุณูุน ุงูุงุฌุชูุงุนู ูุดูู ุฌููุน ุงูุฃุนูุงุฑุ ูุฎุงุตุฉ ูู ูู ุจุญุงุฌุฉ ููุงูุชูุงู.' }
    ]
  },
  // ุงูุชุนุฏูู 1: ุงููุฑุญูุฉ 7 - ุจูุช ุงูุชุฑุงุซ
  7: {
    id: 7,
    title: 'ุงููุฑุญูุฉ 7: ุจูุช ุงูุชุฑุงุซ',
    subtitle: 'ุงูุณูุน: ุงูููุงุฑุณุฉ ูุงููุดุงุฑูุฉ',
    story: `<div class="story-area"><div class="story-text"><strong>ุงูุฎุชุงู: ุณููุฑุฉ ุงูุณูุน</strong><p>ุจุนุฏ ุฃู ุฃููุช ููุซุง ุฌููุน ุงููุฑุงุญูุ ุนุงุฏุช ุฅูู ุจูุช ูุฏูู ูุงุทูุฉุ ุญูุซ ุฌูุณุช ููุชูููุฑ ุจูู ูุง ุชุนููุชู. ูุงูุช ููุง ุงููุฏูู: "ุงูุชุฑุงุซ ูุง ูุนูุด ูู ุงููุชุจ ููุทุ ุจู ูุนูุด ูู ูููุจูุง ูุฃูุนุงููุง ุงูููููุฉ." ูููุช ููุซุง ุฃู ุงูุณูุน ุงูุฅูุงุฑุงุชู ููุณ ูุฌุฑุฏ ูููุงุชุ ุจู ุณููู ูุฃูุนุงูุ ูุฃู ุงููุญุงูุธุฉ ุนูู ุงูุชุฑุงุซ ุชุจุฏุฃ ุจุชุนููู ูููุงุฑุณุชู ููุดุงุฑูุชู ูุน ุงูุขุฎุฑูู.</p><p style="font-weight:700;margin-top:10px">ุงููุซู: "ูู ูุง ูุงุถู ููุ ูุง ุญุงุถุฑ ูู."</p></div></div>`,
    questions: [
      { q: 'ุญุณุจ ููู ุงููุฏูุฉ ูุงุทูุฉุ ุฃูู ูุนูุด ุงูุชุฑุงุซ ุงูุญููููุ', opts: ['ูู ุงููุชุงุญู ููุท', 'ูู ูููุจูุง ูุฃูุนุงููุง ุงูููููุฉ', 'ูู ุงููุชุจ ุงููุฏููุฉ ููุท'], a: 1, hint: 'ุงููุฏูุฉ ูุฑููุช ุจูู ุงูุชุฑุงุซ ูู ุงููุชุจ ูุงูุชุฑุงุซ "ุงูุญู"... ููุง ูู ูุฐุง ุงูุชุฑุงุซ ุงูุญูุ' },
      { q: 'ูุง ูู ุฃูููุฉ ุงูุชุฑุงุซ ูู ุชุดููู ูุณุชูุจููุงุ', opts: ['ุฃู ูุนูุด ูู ุงููุงุถู ุฏุงุฆููุง', 'ุฃู ุงููุงุถู ูู ุฃุณุงุณ ุงูุญุงุถุฑ ูุงููุณุชูุจูุ ููุฌุจ ุชุนููู ูููุงุฑุณุชู', 'ุฃู ุงููุงุถู ูุนูู ุงูุชูุฏู'], a: 1, hint: 'ุฅุฐุง ูู ููู ููุง ูุงุถู ูุญูุธู... ูููู ูููููุง ุฃู ูููู ูู ุงูุญุงุถุฑุ' },
      { q: 'ุจุนุฏ ุฅููุงู ุฑุญูุฉ ุงูุณูุนุ ูุง ูู ุฃูู ุณููู ูู "ููุซุง" ูุฏู ุนูู ุงููุญุงูุธุฉ ุนูู ุงูุชุฑุงุซุ', opts: ['ุฃู ุชูุณู ูุง ุชุนููุชู ูุชุจุฏุฃ ุดูุฆูุง ุฌุฏูุฏูุง', 'ุฃู ุชุจุฏุฃ ุจููุงุฑุณุฉ ุงูุณูุน ููุดุงุฑูุชู ูุน ุนุงุฆูุชูุง ูุฃุตุฏูุงุฆูุง', 'ุฃู ุชุญุชูุธ ุจุงููุนูููุงุช ูููุณูุง'], a: 1, hint: 'ุงูุชุฑุงุซ ููุณ ูุนูููุฉ ุตุงูุชุฉุ ุจู ูู ุณููู ูุฌุจ ูููู ููุขุฎุฑูู... ููู ูุชู ุฐููุ' }
    ]
  }
};

/* ---------- Utility functions ---------- */
function show(screenId){
  Object.values(screens).forEach(s=>s.classList.remove('active'));
  screens[screenId].classList.add('active');
  window.scrollTo(0,0);
}
startBtn.addEventListener('click', ()=> show('map'));
// ุงูุชุนุฏูู 3: ูุธููุฉ ุฒุฑ ุงูุนูุฏุฉ ููุตูุญุฉ ุงูุฑุฆูุณูุฉ
if (homeBtn) {
    homeBtn.addEventListener('click', () => {
        // ูููู ููุง ุฅุถุงูุฉ ููุฏ ูุญูุธ ุงูุชูุฏู ุฅุฐุง ุฃุฑุฏุชุ ุญุงูููุง ูุนูุฏ ููุดุงุดุฉ ุงูุงูุชุชุงุญูุฉ
        show('splash');
    });
}

// download button - expects ZIP in same folder if you upload it later
downloadBtn.addEventListener('click', ()=> {
  const url = 'rahlet-sanaa.zip';
  window.location.href = url;
});

/* stage dots click */
sDots.forEach(dot=>{
  dot.addEventListener('click', ()=>{
    const stage = Number(dot.dataset.stage);
    // ุชู ุชุจุณูุท ุดุฑุท ุงููุชุญ ููุณูุญ ุจูุชุญ ุงููุฑุงุญู ุงูููุชููุฉ ุฃูุถุงู
    const playable = (stage === 1) || state.stagesCompleted[stage-1] || state.stagesCompleted[stage] || !dot.classList.contains('locked');
    if(playable) openStage(stage);
    else alert('ุฃูููู ุงููุฑุญูุฉ ุงูุณุงุจูุฉ ุฃูููุง ููุชุญ ูุฐู ุงููุฑุญูุฉ.');
  });
});

function openStage(stageId){
  state.currentStage = stageId;
  if(state.stageProgress[stageId] === undefined) state.stageProgress[stageId] = 0;
  renderStage(stageId);
  show('stage');
}

function renderStage(id){
  const st = STAGES[id];
  stageTitle.textContent = st.title;
  stageSubtitle.textContent = st.subtitle;
  let html = '';
  
  // ุฏูุฌ ุงููุตุฉ ูุน ุงูุตูุฑุฉ ูุชูููุฑ ูุงูุจ ูุงุญุฏ
  html += `<div class="card">${st.story}</div>`;


  if(st.questions && st.questions.length > 0){
    html += `<div class="card question-area" id="qArea" style="margin-top:10px"></div>`;
  } else {
    html += `<div style="height:12px"></div>`;
  }

  stageContent.innerHTML = html;
  
  if(st.questions && st.questions.length > 0){
    // ุนูุฏ ูุชุญ ุงููุฑุญูุฉุ ุฅุฐุง ูุงูุช ูุฏ ุงูุชููุช ูุณุจููุงุ ูุฎุชููุง ูุชุฌูุจ ุชูุฑุงุฑ ุงูุฃุณุฆูุฉ
    if(state.stageProgress[id] >= st.questions.length || state.stagesCompleted[id]) {
        completeStage(id);
    } else {
        renderQuestionArea(id, state.stageProgress[id]);
    }
  }
}


/* ---------- Questions rendering (ุงูุชุนุฏูู ุงูุฑุฆูุณู ูุขููุฉ ุงูุฅุฌุงุจุฉ) ---------- */
function renderQuestionArea(stageId, qIndex){
  const st = STAGES[stageId];
  const qArea = document.getElementById('qArea');
  if(!qArea) return;
  
  // ุชุญูู ูู ุงูุชูุงู ุฌููุน ุงูุฃุณุฆูุฉ
  if(qIndex >= st.questions.length){
    completeStage(stageId);
    return;
  }
  
  const q = st.questions[qIndex];
  state.stageProgress[stageId] = qIndex; // ุชุญุฏูุซ ุชูุฏู ุงููุงุนุจ ูู ุงูุณุคุงู

  let html = `<div class="question-title">ุณุคุงู ${qIndex+1}: ${q.q}</div>`;
  html += `<div class="options" id="opts">`;
  q.opts.forEach((opt,idx)=> {
    html += `<button class="option-btn" data-idx="${idx}">${opt}</button>`;
  });
  html += `</div>`;
  // ุฅุถุงูุฉ ูุณุงุญุฉ ุงูุชูููุญ (ุงูุชู ุณุชูุธูุฑ ุฑุณุงูุฉ ุงูุฎุทุฃ ูุงูุชูููุญ)
  html += `<div id="hintArea" class="small" style="color:var(--brown);margin-top:10px;display:none;font-weight:700"></div>`;
  html += `<div class="controls"><button id="exitBtn" class="start-btn gray">ุงูุฎุฑูุฌ ููุฎุฑูุทุฉ</button></div>`;
  qArea.innerHTML = html;

  const opts = qArea.querySelectorAll('.option-btn');
  const hintArea = document.getElementById('hintArea');

  opts.forEach(b=>{
    b.addEventListener('click', ()=>{
      opts.forEach(x=> x.disabled = true);
      const idx = Number(b.dataset.idx);
      
      if(idx === q.a){
        // ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ
        b.classList.add('correct');
        hintArea.style.display = 'none';
        
        // ุงูุงูุชูุงู ููุณุคุงู ุงูุชุงูู
        setTimeout(()=> {
            renderQuestionArea(stageId, qIndex + 1);
        }, 700);
      } else {
        // ุงูุฅุฌุงุจุฉ ุงูุฎุงุทุฆุฉ
        b.classList.add('wrong');
        
        // ุงูุชุนุฏูู 4: ุธููุฑ ุฑุณุงูุฉ ุงูุฎุทุฃ ูุงูุชูููุญ
        hintArea.innerHTML = `**ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ. ุญุงูู ูุฑุฉ ุฃุฎุฑู.**<br>${q.hint}`;
        hintArea.style.display = 'block';

        setTimeout(()=> {
          // ุชูููู ุงูุฃุฒุฑุงุฑ ูุฑุฉ ุฃุฎุฑู ููุงุนุจ ููุญุงูู
          opts.forEach(x=> x.disabled = false);
          b.disabled = true; // ุชุนุทูู ุงูุฒุฑ ุงูุฐู ุชู ุงุฎุชูุงุฑู ุฎุทุฃ
          b.classList.remove('wrong');
        }, 900);
      }
    });
  });

  document.getElementById('exitBtn').addEventListener('click', ()=> show('map'));
}

/* ---------- Complete stage and medals ---------- */
function completeStage(id){
  if(!state.stagesCompleted[id]){
    state.stagesCompleted[id] = true;
    state.medals += 1;
    progressText.textContent = `ูุณุงู ุงูุณูุน ${state.medals}/7`;
    addMedal(STAGES[id].title);
    
    // ุชุญุฏูุซ ุดูู ุงูููุทุฉ ุนูู ุงูุฎุฑูุทุฉ
    const dot = document.querySelector(`.stage-dot[data-stage='${id}']`);
    if(dot){ 
        dot.style.background = 'linear-gradient(135deg,var(--gold),#ffd27a)'; 
        dot.style.color='#6b3b00'; // ุชุบููุฑ ููู ุงูุฎุท ูููุงุณุจ ุงูุฎูููุฉ ุงูุฐูุจูุฉ
        dot.title = 'ููุฌุฒ'; 
    }
    
    // ูุชุญ ุงููุฑุญูุฉ ุงูุชุงููุฉ
    const nextDot = document.querySelector(`.stage-dot[data-stage='${id+1}']`);
    if(nextDot) nextDot.classList.remove('locked');
  }
  
  // ุนุฑุถ ุฑุณุงูุฉ ุงูุฅููุงู ูุงููุณุงู
  fbContent.innerHTML = `<div class="badge">โจ</div><div style="font-weight:800;margin-top:6px">ูุจุฑูู! ุฃูููุช ${STAGES[id].title}</div><div class="small" style="margin-top:6px">ุญุตูุช ุนูู +1 ูุณุงู</div>`;
  show('feedback');
  fbNext.style.display = 'none'; // ูุง ููุฌุฏ ุฒุฑ ุงูุชุงูู ุจุนุฏ ุฅููุงู ุงููุฑุญูุฉ
  fbMap.style.display = 'inline-block';
  fbMap.onclick = ()=> { show('map'); fbMap.style.display='none'; };
}

/* add medal to rewards modal */
function addMedal(title){
  const el = document.createElement('div');
  el.style.cssText = 'width:120px;text-align:center';
  el.innerHTML = `<div style="width:80px;height:80px;border-radius:12px;background:linear-gradient(135deg,#ffd27a,#f6c34d);display:flex;align-items:center;justify-content:center;font-weight:800">โจ</div><div class="small" style="margin-top:6px">${title}</div>`;
  medalsBox.appendChild(el);
}

/* ---------- Controls ---------- */
exitStage.addEventListener('click', ()=> show('map'));
openRewards.addEventListener('click', ()=> rewardsModal.style.display='flex');
closeRewards.addEventListener('click', ()=> rewardsModal.style.display='none');
document.querySelector(`.stage-dot[data-stage='1']`).classList.remove('locked');

</script>
</body>
</html>
